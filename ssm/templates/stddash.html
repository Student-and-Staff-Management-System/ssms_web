{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard - {{ student.student_name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="https://res.cloudinary.com/deocom5lr/image/upload/v1754117176/annamalai_kuoh1j.png" type="image/png">
    <style>
        :root {
            --primary-bg: #f8f9fa;
            --secondary-bg: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --accent-color: #5a7d7c;
            --accent-color-hover: #4a6b69;
            --light-accent-bg: #eef2f2;
        }
        * { box-sizing: border-box; }
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: var(--primary-bg); 
            color: var(--text-primary); 
            margin: 0; 
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        main { flex-grow: 1; }
        
        .dashboard-container { 
            max-width: 1600px;
            margin: auto; 
            padding: 30px 20px;
        }
        
        .page-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px;
        }
        .page-header .title-group { display: flex; align-items: center; gap: 15px; }
        .page-header h1 { margin: 0; font-size: 1.8em; font-weight: 600; }
        .header-actions { display: flex; align-items: center; gap: 12px; }
        .action-btn { 
            display: inline-block; 
            padding: 10px 18px; 
            border: none; 
            border-radius: 6px; 
            background-color: var(--accent-color); 
            color: white; 
            text-decoration: none; 
            font-size: 0.95em; 
            font-family: 'Poppins', sans-serif; 
            cursor: pointer; 
            transition: background-color 0.3s;
        }
        .action-btn:hover { background-color: var(--accent-color-hover); }
        
        .profile-header-card {
            background-color: var(--secondary-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 25px;
        }
        .profile-photo { 
            width: 110px; 
            height: 110px; 
            border-radius: 50%; 
            object-fit: cover; 
            border: 3px solid var(--primary-bg); 
            flex-shrink: 0;
        }
        .profile-info { width: 100%; }
        .profile-info h2 { margin: 0 0 5px 0; font-size: 1.8em; font-weight: 600; }
        .profile-info p { color: var(--text-secondary); margin: 0 0 15px 0; font-size: 1em; }
        
        .essential-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        .essential-links a {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background-color: var(--light-accent-bg);
            color: var(--accent-color);
            text-decoration: none;
            border-radius: 5px;
            font-weight: 500;
            font-size: 0.85em;
            transition: background-color 0.3s, color 0.3s;
        }
        .essential-links a:hover {
            background-color: var(--accent-color);
            color: white;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: start;
        }

        .card { 
            background-color: var(--secondary-bg); 
            border-radius: 8px; 
            border: 1px solid var(--border-color); 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
            padding: 20px;
            margin-bottom: 25px;
            height: fit-content;
        }
        .card:last-child { margin-bottom: 0; }
        
        .card-title { 
            font-size: 1.2em; 
            font-weight: 600; 
            margin-top: 0; 
            margin-bottom: 15px; 
            padding-bottom: 12px; 
            border-bottom: 2px solid var(--border-color);
            color: var(--accent-color);
        }
        
        .details-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px 20px;
        }

        .detail-item { 
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .detail-item strong { 
            color: var(--text-secondary); 
            font-size: 0.85em; 
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .detail-item span, .detail-item a { 
            word-wrap: break-word;
            font-size: 0.95em;
            color: var(--text-primary);
        }
        .detail-item a { 
            color: var(--accent-color); 
            text-decoration: none; 
            font-weight: 500;
        }
        .detail-item a:hover { text-decoration: underline; }
        
        .academic-section { 
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        .academic-section:first-child { margin-top: 0; padding-top: 0; border-top: none; }
        .academic-section h4 { 
            margin: 0 0 12px 0; 
            color: var(--accent-color);
            font-size: 1em;
            font-weight: 600;
        }
        
        .scholarship-list { 
            list-style-type: none; 
            padding: 0; 
            margin: 0;
        }
        .scholarship-list li { 
            background-color: var(--primary-bg); 
            padding: 8px 12px; 
            border-radius: 5px; 
            margin-bottom: 6px; 
            font-size: 0.9em;
        }
        .scholarship-list li:last-child { margin-bottom: 0; }

        /* Document links styling */
        .document-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .document-link-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background-color: var(--primary-bg);
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .document-link-item:hover {
            background-color: var(--light-accent-bg);
        }
        .document-link-item strong {
            color: var(--text-primary);
            font-size: 0.9em;
            font-weight: 500;
        }
        .document-link-item a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9em;
            padding: 4px 10px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .document-link-item a:hover {
            background-color: var(--accent-color);
            color: white;
        }
        .document-link-item span {
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .profile-header-card { 
                flex-direction: column; 
                text-align: center;
                padding: 20px;
            }
            .page-header { 
                flex-direction: column; 
                gap: 15px;
                align-items: stretch;
            }
            .header-actions {
                justify-content: center;
            }
            .essential-links { 
                justify-content: center;
            }
            .details-grid {
                grid-template-columns: 1fr;
            }
            .dashboard-container {
                padding: 20px 15px;
            }
        }
        
        @media print {
            .no-print { display: none !important; }
            body { 
                padding: 15px !important; 
                margin: 0 !important; 
                background: #ffffff !important; 
                color: #000000 !important;
            }
            .dashboard-container { 
                width: 100% !important; 
                max-width: 100% !important; 
                padding: 0 !important;
            }
            * { 
                color: #000000 !important; 
                background: transparent !important; 
                box-shadow: none !important;
            }
            .dashboard-grid { 
                display: block !important;
            }
            .card { 
                border: 1px solid #ccc !important; 
                page-break-inside: avoid; 
                margin-bottom: 15px !important; 
                padding: 12px !important;
            }
            a, a:visited { 
                text-decoration: none !important; 
                color: #000000 !important;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="page-header no-print">
            <div class="title-group">
                <img src="https://res.cloudinary.com/deocom5lr/image/upload/v1754117176/annamalai_kuoh1j.png" alt="Annamalai University Logo" style="height:40px;">
                <h1>Student Dashboard</h1>
            </div>
            <div class="header-actions">
                <button onclick="window.print()" class="action-btn">üñ®Ô∏è Print</button>
                <a href="{% url 'student_logout' %}" class="action-btn">Logout</a>
            </div>
        </header>

        <main>
            <div class="profile-header-card no-print">
                {% if student.studentdocuments.student_photo %}
                    <img src="{{ student.studentdocuments.student_photo.url }}" alt="Student Photo" class="profile-photo">
                {% else %}
                    <img src="https://placehold.co/180x180/EFEFEF/AAAAAA?text=No+Photo" alt="No Photo Available" class="profile-photo">
                {% endif %}
                <div class="profile-info">
                    <h2>{{ student.student_name }}</h2>
                    <p>{{ student.roll_number }} | {{ student.get_program_level_display }}</p>
                    
                    <div class="essential-links">
                        <a href="{% url 'exam_timetable' %}">üìÖ Timetable</a>
                        <a href="https://annamalaiuniversity.ac.in/aucoe/rs_view.php" target="_blank">üéì Results</a>
                        {% comment %} <a href="{% url 'service_unavailable' %}">‚úÖ Attendance</a> {% endcomment %}
                        <a href="{% url 'service_unavailable' %}">‚úÖ Attendance</a>
                        <a href="https://annamalaiuniversity.ac.in/" target="_blank">üè´ AU Main Site</a>
                        <a href="https://annamalaiuniversity.ac.in/studport/epayment_rgl_hfee.php?mode=oNln" target="_blank">üí≥ Hostel Fees</a>
                        <a href="https://annamalaiuniversity.ac.in/studport/tf_general_pharmacy.php?fee=tf" target="_blank">üí≥ Tuition Fees</a>
                        <a href="{% url 'student_editprofile' %}">‚úèÔ∏è Edit Profile</a>
                        <a href="{% url 'help_and_support' %}">‚ùì Support</a>
                        <a href="{% url 'service_unavailable' %}">üóíÔ∏èAI Resume Generation</a>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- Left Column -->
                <div class="main-content">
                    <div class="card">
                        <h2 class="card-title">Personal & Contact Info</h2>
                        <div class="details-grid">
                            <div class="detail-item"><strong>Name</strong> <span>{{ student.student_name }}</span></div>
                            <div class="detail-item"><strong>Email</strong> <span>{{ student.student_email }}</span></div>
                            <div class="detail-item"><strong>Mobile</strong> <span>{{ student.personalinfo.student_mobile|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Date of Birth</strong> <span>{{ student.personalinfo.date_of_birth|date:"d M Y"|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Gender</strong> <span>{{ student.personalinfo.get_gender_display|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Blood Group</strong> <span>{{ student.personalinfo.get_blood_group_display|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Community</strong> <span>{{ student.personalinfo.community|default:"N/A" }}</span></div>

                            <div class="detail-item">
                                <strong>Caste</strong>
                                <span>
                                    {% if student.personalinfo.caste %}
                                        {{ student.personalinfo.caste.name }}
                                    {% elif student.personalinfo.caste_other %}
                                        {{ student.personalinfo.caste_other }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </span>
                            </div>
                            <div class="detail-item"><strong>Religion</strong> <span>{{ student.personalinfo.get_religion_display|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>UMIS ID</strong> <span>{{ student.personalinfo.umis_id|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>EMIS ID</strong> <span>{{ student.personalinfo.emis_id|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>ABC ID</strong> <span>{{ student.personalinfo.abc_id|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Aadhaar Number</strong> <span>{{ student.personalinfo.aadhaar_number|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Present Address</strong> <span>{{ student.personalinfo.present_address|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Permanent Address</strong> <span>{{ student.personalinfo.permanent_address|default:"N/A" }}</span></div>

                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Parent Details</h2>
                        <div class="details-grid">
                            <div class="detail-item"><strong>Father's Name</strong> <span>{{ student.personalinfo.father_name|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Father's Mobile</strong> <span>{{ student.personalinfo.father_mobile|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Father's Occupation</strong> <span>{{ student.personalinfo.father_occupation|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Mother's Name</strong> <span>{{ student.personalinfo.mother_name|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Mother's Mobile</strong> <span>{{ student.personalinfo.mother_mobile|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Mother's Occupation</strong> <span>{{ student.personalinfo.mother_occupation|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Annual Income</strong> <span>Rs. {{ student.personalinfo.parent_annual_income|default:"N/A" }}</span></div>
                        </div>
                    </div>
                    
                    

                    <div class="card">
                        <h2 class="card-title">Academic History</h2>
                        {% with history=student.academichistory %}
                            {% if history.sslc_school_name %}
                            <div class="academic-section">
                                <h4>SSLC Details</h4>
                                <div class="details-grid">
                                    <div class="detail-item"><strong>School</strong> <span>{{ history.sslc_school_name }}</span></div>
                                    <div class="detail-item"><strong>Percentage</strong> <span>{{ history.sslc_percentage }}%</span></div>
                                    <div class="detail-item"><strong>Year of Passing</strong> <span>{{ history.sslc_year_of_passing }}</span></div>
                                    <div class="detail-item"><strong>School Name</strong> <span>{{ history.sslc_school_name }}</span></div>
                                    <div class="detail-item"><strong>School Address</strong> <span>{{ history.sslc_school_address }}</span></div>
                                </div>
                            </div>
                            {% endif %}
                            {% if history.hsc_school_name %}
                            <div class="academic-section">
                                <h4>HSC Details</h4>
                                <div class="details-grid">
                                    <div class="detail-item"><strong>School</strong> <span>{{ history.hsc_school_name }}</span></div>
                                    <div class="detail-item"><strong>Percentage</strong> <span>{{ history.hsc_percentage }}%</span></div>
                                    <div class="detail-item"><strong>Year of Passing</strong> <span>{{ history.hsc_year_of_passing }}</span></div>
                                    <div class="detail-item"><strong>School Name</strong> <span>{{ history.hsc_school_name }}</span></div>
                                    <div class="detail-item"><strong>School Address</strong> <span>{{ history.hsc_school_address }}</span></div>
                                </div>
                            </div>
                            {% endif %}
                        {% endwith %}
                    </div>
                </div>
                
                <!-- Right Column -->
                <div class="side-content">
                    <div class="card">
                        <h2 class="card-title">Scholarship Details</h2>
                        <div class="details-grid">
                            {% with scholarship=student.scholarshipinfo %}
                                <div class="detail-item"><strong>Applying for Scholarship?</strong> <span>{% if student.personalinfo.has_scholarship %}Yes{% else %}No{% endif %}</span></div>
                                {% if student.personalinfo.has_scholarship %}
                                <div class="detail-item" style="grid-column: 1 / -1;">
                                    <strong>Scholarships</strong>
                                    <ul class="scholarship-list">
                                        {% if scholarship.is_first_graduate %}<li>First Graduate</li>{% endif %}
                                        {% if scholarship.sch_bcmbc %}<li>BC/MBC</li>{% endif %}
                                        {% if scholarship.sch_postmetric %}<li>SC/ST POSTMETRIC</li>{% endif %}
                                        {% if scholarship.sch_pm %}<li>Prime Minister Scholarship</li>{% endif %}
                                        {% if scholarship.sch_govt %}<li>Govt 7.5% Scholarship</li>{% endif %}
                                        {% if scholarship.sch_pudhumai %}<li>Pudhumai Penn Scheme</li>{% endif %}
                                        {% if scholarship.sch_tamizh %}<li>Tamizh Pudalvan Scheme</li>{% endif %}
                                        {# --- FIX APPLIED HERE --- #}
                                        {% if scholarship.sch_private %}
                                        <li>
                                            Private Scholarship
                                            {# This checks if a name was provided before showing it #}
                                        {% if scholarship.private_scholarship_name %}
                                        : {{ scholarship.private_scholarship_name }}
                                        {% endif %}
                                        </li>
                                        {% endif %}
                                    </ul>
                                </div>
                                {% endif %}
                            {% endwith %}
                        </div>
                    </div>

                    <div class="card no-print">
                        <h2 class="card-title">Uploaded Documents</h2>
                        {% with doc=student.studentdocuments %}
                        <div class="document-links">
                            <div class="document-link-item">
                                <strong>ID Card</strong>
                                {% if doc.student_id_card %}<a href="{{ doc.student_id_card.url }}" target="_blank">View ‚Üí</a>{% else %}<span>N/A</span>{% endif %}
                            </div>
                            <div class="document-link-item">
                                <strong>Community Certificate</strong>
                                {% if doc.community_certificate %}<a href="{{ doc.community_certificate.url }}" target="_blank">View ‚Üí</a>{% else %}<span>N/A</span>{% endif %}
                            </div>
                            <div class="document-link-item">
                                <strong>Aadhaar Card</strong>
                                {% if doc.aadhaar_card %}<a href="{{ doc.aadhaar_card.url }}" target="_blank">View ‚Üí</a>{% else %}<span>N/A</span>{% endif %}
                            </div>
                            <div class="document-link-item">
                                <strong>SSLC Marksheet</strong>
                                {% if doc.sslc_marksheet %}<a href="{{ doc.sslc_marksheet.url }}" target="_blank">View ‚Üí</a>{% else %}<span>N/A</span>{% endif %}
                            </div>
                            <div class="document-link-item">
                                <strong>HSC Marksheet</strong>
                                {% if doc.hsc_marksheet %}<a href="{{ doc.hsc_marksheet.url }}" target="_blank">View ‚Üí</a>{% else %}<span>N/A</span>{% endif %}
                            </div>
                                <div class="document-link-item">
                                <strong>Income Certificate</strong>
                                {% if doc.income_certificate %}<a href="{{ doc.income_certificate.url }}" target="_blank">View ‚Üí</a>{% else %}<span>N/A</span>{% endif %}
                            </div>
                                <div class="document-link-item">
                                <strong>Bank Passbook</strong>
                                {% if doc.bank_passbook %}<a href="{{ doc.bank_passbook.url }}" target="_blank">View ‚Üí</a>{% else %}<span>N/A</span>{% endif %}
                            </div>
                            <!-- === THIS IS THE FIX === -->
                            <!-- This block will only be rendered if a First Graduate Certificate has been uploaded -->
                            {% if doc.first_graduate_certificate %}
                            <div class="document-link-item">
                                <strong>First Graduate Certificate</strong>
                                <a href="{{ doc.first_graduate_certificate.url }}" target="_blank">View ‚Üí</a>
                            </div>
        
                            {% endif %}
                            <!-- === THIS IS THE FIX END === -->

                             <!-- === THIS IS THE FIX === -->
                            <!-- This block will only be rendered if a First Graduate Certificate has been uploaded -->
                            {% if doc.driving_license %}
                            <div class="document-link-item">
                                <strong>Driving License</strong>
                                <a href="{{ doc.driving_license.url }}" target="_blank">View ‚Üí</a>
                            </div>
                            {% endif %}
                            <!-- === THIS IS THE FIX END === -->
                        </div>
                        {% endwith %}
                    </div>


                     <div class="card">
                        <h2 class="card-title">Bank Account Details</h2>
                        <div class="details-grid">
                            <div class="detail-item"><strong>Account Holder's Name</strong> <span>{{ student.bankdetails.account_holder_name|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Bank Account Number</strong> <span>{{ student.bankdetails.account_number|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>IFSC Code</strong> <span>{{ student.bankdetails.ifsc_code|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Bank Name</strong> <span>{{ student.bankdetails.bank_name|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Branch Name</strong> <span>{{ student.bankdetails.branch_name|default:"N/A" }}</span></div>

                        </div>
                    </div>

                        <div class="card no-print">
                        <h2 class="card-title">Other Details</h2>
                        <div class="details-grid">
                            <div class="detail-item"><strong>Ambition</strong> <span>{{ student.otherdetails.ambition|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Role Model</strong> <span>{{ student.otherdetails.role_model|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Hobbies</strong> <span>{{ student.otherdetails.hobbies|default:"N/A" }}</span></div>
                             <div class="detail-item"><strong>Identification Marks</strong> <span>{{ student.otherdetails.identification_marks|default:"N/A" }}</span></div>

                        </div>

                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>